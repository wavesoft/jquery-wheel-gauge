/*! .rundial() - A retro spin dial Authors & copyright (c) 2014 Ioannis Charalampidis. MIT License. */
;$.fn.rundial=function(b,a){return this.each(function(g,c){var n=$(c),d=b||"create",j=n.data("rundial");if(!j||(d=="create")){var l=b||{};j={min:l.min||parseFloat(n.attr("data-min"))||0,max:l.max||parseFloat(n.attr("data-max"))||100,width:l.width||"auto",height:l.height||Math.max(n.height(),64),step:l.step||parseFloat(n.attr("data-step"))||1,value:(l.value==undefined?(n.val()==""?(n.attr("value")==undefined?l.min:parseFloat(n.attr("value"))):parseFloat(n.val())):l.value),dampValue:l.dampValue||10,updateDelay:l.updateDelay||30,format:l.format||function(e){return String(e)},overflowText:l.overflowText||"(!)",overflowElmClass:l.overflowElmClass||"rundial-warn",overflowClass:l.overflowClass||"rundial-overrun",underflowText:l.underflowText||"(!)",underflowElmClass:l.underflowElmClass||"rundial-warn",underflowClass:l.underflowClass||"rundial-underrun",adoptClasses:(l.adoptClasses==undefined)?true:l.adoptClasses,ascending:(l.ascending==undefined)?false:l.ascending,_lastTargetVal:0,_useVal:$(n).is("input"),_input:$(n),_activeTimer:0};if(j._useVal){j._input.val(j.value)}else{j._input.attr("value",j.value)}var m=$('<div class="rundial"></div>'),k=$('<div class="rundial-host"></div>').appendTo(m),g=$('<div class="rundial-indicator-bar"></div>').appendTo(k),o=[$('<div class="rundial-value">-1</div>').appendTo(k),$('<div class="rundial-value">0</div>').appendTo(k).css({"font-weight":"bold"}),$('<div class="rundial-value">1</div>').appendTo(k)];if((j.width!="auto")&&(j.width)){m.css({width:j.width})}if((j.height!="auto")&&(j.height)){m.css({height:j.height})}if(j.adoptClasses){m.attr("class",n.attr("class"));m.addClass("rundial")}j.container=m;j.host=k;j.valueElements=o;j.wrapStep=function(e){if(e>this.max){e=this.max}if(e<this.min){e=this.min}return Math.round((e-this.min)/this.step)*this.step+this.min};j.setValue=function(u){var q=0.5,w=this.wrapStep(u),e=w-this.step,i=w+this.step,r=(this.ascending?(w-u):(u-w))/this.step,t=this.height*(1-q)/2,s=t+r*this.height*q;var p=0,h=2;if(!this.ascending){p=2,h=0}if(this.ascending){this.valueElements[p].css({top:s-this.height*q});this.valueElements[h].css({top:s+this.height*q})}else{this.valueElements[p].css({top:s+this.height*q});this.valueElements[h].css({top:s-this.height*q})}this.valueElements[1].css({top:s});if(e<this.min){if(u<this.min){this.valueElements[p].html(this.underflowText);this.valueElements[p].addClass(this.underflowElmClass)}else{this.valueElements[p].text("");this.valueElements[p].removeClass(this.underflowElmClass)}}else{this.valueElements[p].text(this.format(e));this.valueElements[p].removeClass(this.underflowElmClass)}if(i>this.max){if(u>this.max){this.valueElements[h].html(this.overflowText);this.valueElements[h].addClass(this.overflowElmClass)}else{this.valueElements[h].text("");this.valueElements[h].removeClass(this.overflowElmClass)}}else{this.valueElements[h].text(this.format(i));this.valueElements[h].removeClass(this.overflowElmClass)}this.valueElements[1].text(this.format(w));if(u<this.min){j.host.addClass(this.underflowClass)}else{j.host.removeClass(this.underflowClass)}if(u>this.max){j.host.addClass(this.overflowClass)}else{j.host.removeClass(this.overflowClass)}};j.tick=function(){var e;if(this._useVal){e=parseFloat(this._input.val())}else{e=parseFloat(this._input.attr("value"))}if(isNaN(e)){e=this._lastTargetVal}this._lastTargetVal=e;if(e<this.min){e=this.min-((this.min-e)/(this.max-this.min))*this.step/2;if(e<this.min-this.step/2){e=this.min-this.step/2}}else{if(e>this.max){e=this.max+((e-this.max)/(this.max-this.min))*this.step/2;if(e>this.max+this.step/2){e=this.max+this.step/2}}}if(Math.abs(e-this.value)>0.01){this.value+=(e-this.value)/this.dampValue;this.setValue(this.value)}else{if(e!=this.value){this.value=e;this.setValue(this.value);clearInterval(this._activeTimer);this._activeTimer=0}}};j.startTimer=function(){var e=this;if(this._activeTimer){clearInterval(this._activeTimer)}this._activeTimer=setInterval(function(){e.tick()},j.updateDelay)};n.change(function(){j.startTimer()});j.setValue(j.value);n.data("rundial",j);m.insertBefore(n);n.hide()}else{if(d=="value"){if(a==undefined){var f;if(j._useVal){f=parseFloat(j._input.val())}else{f=parseFloat(j._input.attr("value"))}return f}else{if(j._useVal){j._input.val(a)}else{j._input.attr("value",a)}j.startTimer()}}}})};